<!doctype html>

<body>
    <canvas id="gameCanvas" width="1000" height="800"></canvas>
    <script>
        var canvas, canvasContext;

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', KeyPressed);
            document.addEventListener('keyup', KeyReleased);

            setInterval(mainloop, 1000 / 50);
        }

        //player vars
        var PlayerXpos = 0;
        var PlayerYpos = 0;
        const PLAYER_SIZE = 60;
        var PlayerXspeed = 10;
        var PlayerYspeed = 10;
        var ship = new Image();
        ship.src = 'images/Ship.png'

        //Background vars
        var backgroundheight = 800;
        var backgroundwidth = 1000;
        var background = new Image();
        background.src = 'images/Background.jpg';

        //movement vars
        var leftKeyPressed = false;
        var rightKeyPressed = false;
        var upKeyPressed = false;
        var downKeyPressed = false;

        const LEFT_KEY = 37;
        const UP_KEY = 38;
        const RIGHT_KEY = 39;
        const DOWN_KEY = 40;

        //enemy vars
        var Enemys = [];
        var settingUp = true;
        var totalEnemys = 10;
        var enemysprite = new Image();
        enemysprite.src = 'images/enemy.png'
        
        //scoring vars
        var Health = 3;
        var Kills = 0;
        var Timer = 60;

        function mainloop() {
            drawImg(background, 0, 0, backgroundwidth, backgroundheight);//bg
            drawImg(ship, PlayerXpos, PlayerYpos, 60, 90); //player
            drawImg(enemysprite, EnemyXpos ,EnemyYpos ,100 ,50);//enemy

            if (settingUp) {
                for (var i = 0; i < totalEnemys; i++) {
                    setUp();
                }
                settingUp = false;
            }
            PlayerMove();
            DrawEnemys();
            moveEnemys();
        } // end func


        function KeyPressed(evt) {
            if (evt.keyCode == LEFT_KEY) { //left
                leftKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_KEY) { // right
                rightKeyPressed = true;
            }
            if (evt.keyCode == UP_KEY) { // up
                upKeyPressed = true;
            }
            if (evt.keyCode == DOWN_KEY) { // down
                downKeyPressed = true;
            }
        } // end func

        function KeyReleased(evt) {
            if (evt.keyCode == LEFT_KEY) { //left
                leftKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_KEY) { // right
                rightKeyPressed = false;
            }
            if (evt.keyCode == UP_KEY) { // up
                upKeyPressed = false;
            }
            if (evt.keyCode == DOWN_KEY) { // down
                downKeyPressed = false;
            }
        } // end func
        function PlayerMove() {
            if (rightKeyPressed) {
                PlayerXpos += PlayerXspeed;
                if (PlayerXpos > canvas.width) {
                    PlayerXpos = 0;
                }
            }
            if (leftKeyPressed) {
                PlayerXpos -= PlayerXspeed;
                if (PlayerXpos < 0 - PLAYER_SIZE) {
                    PlayerXpos = canvas.width - PLAYER_SIZE;
                }
            }
            if (upKeyPressed) {
                PlayerYpos -= PlayerYspeed;
                if (PlayerYpos < 0 - PLAYER_SIZE) {
                    PlayerYpos = canvas.height - PLAYER_SIZE;
                }
            }
            if (downKeyPressed) {
                PlayerYpos += PlayerYspeed;
                if (PlayerYpos > canvas.width) {
                    PlayerYpos = 0;
                }
            }
        } // end func
        function setUp() {
            var EnemySize = Math.floor(Math.random() * (100 - 10)) + 10;
            var EnemyXpos = Math.floor(Math.random() * ((canvas.width - EnemySize) - 0)) + 0;
            var EnemyYpos = Math.floor(Math.random() * ((canvas.height - EnemySize) - 0)) + 0;
            var EnemyYspeed = Math.floor(Math.random() * (10 - 1)) + 1;
            var EnemyXspeed = Math.floor(Math.random() * (10 - 1)) + 1;

            var Enemy = {
                EnemyXpos: EnemyXpos,
                EnemyYpos: EnemyYpos,
                EnemySize: EnemySize,
                EnemyXspeed: EnemyXspeed,
                EnemyYspeed: EnemyYspeed,
            }

            Enemys.push(Enemy);

        } // end func 
        function DrawEnemys() {
            Enemys.forEach(function(Enemy, i) {
                colorRect(Enemy.EnemyXpos, Enemy.EnemyYpos, Enemy.EnemySize, Enemy.EnemySize, 'purple');
            });
        }; // end func

        function EnemyRandomSpawns() {
            math.random() * canvas.width
        }; // end func

        function moveEnemys() {
            Enemys.forEach(function(Enemy, i) {
                Enemy.EnemyXpos += Enemy.EnemyXspeed; // move x
                Enemy.EnemyYpos += Enemy.EnemyYspeed; // move y

                //Right edge bounce
                if (Enemy.EnemyXpos + Enemy.EnemySize > canvas.width) {
                    Enemy.EnemyXspeed *= -1;

                }

                //Left Edge Bounce
                if (Enemy.EnemyXpos < 0) {
                    Enemy.EnemyXspeed *= -1;
                }

                if (Enemy.EnemyYpos > canvas.height) {
                    Enemy.EnemyYpos = 0 - Enemy.EnemySize;
                    Enemy.EnemySize = Math.floor(Math.random() * (80 - 20)) + 10;
                    Enemy.EnemyYspeed = Math.floor(Math.random() * (10 - 1)) + 1;
                    Enemy.EnemyXspeed = Math.floor(Math.random() * (10 - 1)) + 1;

                }
                if (Enemy.EnemyYpos + Enemy.EnemySize > PlayerYpos && Enemy.EnemyYpos < PlayerYpos + PLAYER_SIZE && Enemy.EnemyXpos + Enemy.EnemySize > PlayerXpos && Enemy.EnemyXpos < PlayerXpos + PLAYER_SIZE) {
                    PlayerXpos = 500;
                    PlayerYpos = 400;
                    Health--;
                    console.log('Health:' + Health);
                }
            });
        } //end func

        function drawImg(src, x, y, w, h) {
            canvasContext.drawImage(src, x, y, w, h);
        } // end func

        function GameOver() {
            if (Health < 1) {
                PlayerXpos = 400;
            }
        } // end func

        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        } // end func 

    </script>
</body>
