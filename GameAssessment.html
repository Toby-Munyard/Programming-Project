<!doctype html>

<body>
    <canvas id="gameCanvas" width="1000" height="800"></canvas>
    <script>
        var canvas, canvasContext;

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', KeyPressed);
            document.addEventListener('keyup', KeyReleased);

            setInterval(mainloop, 1000 / 50);
        }

        //player vars
        var PlayerXpos = 0;
        var PlayerYpos = 0;
        const PLAYER_SIZE = 60;
        var PlayerXspeed = 10;
        var PlayerYspeed = 10;
        var ship = new Image();
        ship.src = 'images/Ship.png'

        //Background vars
        var backgroundheight = 800;
        var backgroundwidth = 1000;
        var background = new Image();
        background.src = 'images/Background.jpg';

        //movement vars
        var leftKeyPressed = false;
        var rightKeyPressed = false;
        var upKeyPressed = false;
        var downKeyPressed = false;

        const LEFT_KEY = 37;
        const UP_KEY = 38;
        const RIGHT_KEY = 39;
        const DOWN_KEY = 40;

        //enemy vars
        var Enemys = [];
        var settingUp = true;
        var totalEnemys = 15;
        var enemysprite = new Image();
        enemysprite.src = 'images/enemy.png';
        
        //health
        var pickups = [];
        var settingup = true;
        var totalpickup = 2;
        var pickupSprite = new Image();
        pickupSprite.src = 'images/pickup.png';
        
        //scoring vars
        var Health = 5;
        var Kills = 0;
        var Timer = 60;
        
        //bullet vars
        var bullet = new Image();
        bullet.src = 'images/bullet.png';

        function KeyPressed(evt) {
            if (evt.keyCode == LEFT_KEY) { //left
                leftKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_KEY) { // right
                rightKeyPressed = true;
            }
            if (evt.keyCode == UP_KEY) { // up
                upKeyPressed = true;
            }
            if (evt.keyCode == DOWN_KEY) { // down
                downKeyPressed = true;
            }
        } // end func

        function KeyReleased(evt) {
            if (evt.keyCode == LEFT_KEY) { //left
                leftKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_KEY) { // right
                rightKeyPressed = false;
            }
            if (evt.keyCode == UP_KEY) { // up
                upKeyPressed = false;
            }
            if (evt.keyCode == DOWN_KEY) { // down
                downKeyPressed = false;
            }
        } // end func
        function PlayerMove() {
            if (rightKeyPressed) {
                PlayerXpos += PlayerXspeed;
                if (PlayerXpos > canvas.width) {
                    PlayerXpos = 0;
                }
            }
            if (leftKeyPressed) {
                PlayerXpos -= PlayerXspeed;
                if (PlayerXpos < 0 - PLAYER_SIZE) {
                    PlayerXpos = canvas.width - PLAYER_SIZE;
                }
            }
            if (upKeyPressed) {
                PlayerYpos -= PlayerYspeed;
                if (PlayerYpos < 0 - PLAYER_SIZE) {
                    PlayerYpos = canvas.height - PLAYER_SIZE;
                }
            }
            if (downKeyPressed) {
                PlayerYpos += PlayerYspeed;
                if (PlayerYpos > canvas.width) {
                    PlayerYpos = 0;
                }
            }
        } // end func
        function setUp() {
            var EnemySize = Math.floor(Math.random() * (100 - 10)) + 10;
            var EnemyXpos = Math.floor(Math.random() * ((canvas.width - EnemySize) - 0)) + 0;
            var EnemyYpos = Math.floor(Math.random() * ((canvas.height - EnemySize) - 0)) + 0;
            var EnemyYspeed = Math.floor(Math.random() * (10 - 1)) + 1;
            var EnemyXspeed = Math.floor(Math.random() * (10 - 1)) + 1;

            var Enemy = {
                EnemyXpos: EnemyXpos,
                EnemyYpos: EnemyYpos,
                EnemySize: EnemySize,
                EnemyXspeed: EnemyXspeed,
                EnemyYspeed: EnemyYspeed,
            }
            
            Enemys.push(Enemy);

        } // end func
        
        function createPickUp(){
            var PickupSize = Math.floor(Math.random() * (100 - 10)) + 10;
            var PickupXpos = Math.floor(Math.random() * ((canvas.width - PickupSize) - 0)) + 0;
            var PickupYpos = Math.floor(Math.random() * ((canvas.height - PickupSize) - 0)) + 0;
            
            var p = {
                PickupXpos: PickupXpos,
                PickupYpos: PickupYpos,
                PickupSize: PickupSize,
            }

            pickups.push(p);
            
        }
        
        var counter = 0;
        var randTime = Math.floor(Math.random()*100);
        
        function pickUpGen(){
            counter++; 
            
            if(counter == randTime){
               createPickUp();
               randTime = Math.floor(Math.random()*100); 
                counter = 0;
                console.log('health')
            }
        }
        
        function DrawPickups() {
            pickups.forEach(function(health, i) {
                drawImg(pickupSprite, health.PickupXpos ,health.PickupYpos,health.PickupSize ,health.PickupSize );
            });
        }; // end func
        function DrawEnemys() {
            Enemys.forEach(function(Enemy, i) {
                drawImg(enemysprite, Enemy.EnemyXpos ,Enemy.EnemyYpos,Enemy.EnemySize ,Enemy.EnemySize);
            });
        }; // end func

        function EnemyRandomSpawns() {
            math.random() * canvas.width
        }; // end func

        function moveEnemys() {
            Enemys.forEach(function(Enemy, i) {
                Enemy.EnemyXpos += Enemy.EnemyXspeed; // move x
                Enemy.EnemyYpos += Enemy.EnemyYspeed; // move y

                //Right edge bounce
                if (Enemy.EnemyXpos + Enemy.EnemySize > canvas.width) {
                    Enemy.EnemyXspeed *= -1;

                }

                //Left Edge Bounce
                if (Enemy.EnemyXpos < 0) {
                    Enemy.EnemyXspeed *= -1;
                }

                if (Enemy.EnemyYpos > canvas.height) {
                    Enemy.EnemyYpos = 0 - Enemy.EnemySize;
                    Enemy.EnemySize = Math.floor(Math.random() * (80 - 10)) + 10;
                    Enemy.EnemyYspeed = Math.floor(Math.random() * (10 - 1)) + 1;
                    Enemy.EnemyXspeed = Math.floor(Math.random() * (10 - 1)) + 1;

                }
                if (Enemy.EnemyYpos + Enemy.EnemySize > PlayerYpos && Enemy.EnemyYpos < PlayerYpos + PLAYER_SIZE && Enemy.EnemyXpos + Enemy.EnemySize > PlayerXpos && Enemy.EnemyXpos < PlayerXpos + PLAYER_SIZE) {
                    Enemy.EnemyXpos = 0;
                    Enemy.EnemyYpos = 0;
                    PlayerXpos = canvas.width / 2 - PLAYER_SIZE / 2;
                    PlayerYpos = canvas.height * .8;
                    Health--;
                    console.log('Health:' + Health);
                }
            });
        } //end func

        function drawImg(src, x, y, w, h) {
            canvasContext.drawImage(src, x, y, w, h);
        } // end func

        function GameOver() {
            if (Health < 1) {
                PlayerXpos = 400;
            }
        } // end func
        function mainloop() {
            drawImg(background, 0, 0, backgroundwidth, backgroundheight);//bg
            drawImg(ship, PlayerXpos, PlayerYpos, 60, 90); //player
            drawImg(enemysprite, 0 ,0,0 ,0);//enemy
//            drawImg(pickupSprite,100,100,50,50);//healthpickup
            pickUpGen();
            DrawPickups();
            
            if (settingUp) {
                for (var i = 0; i < totalEnemys; i++) {
                    setUp();
                }
                settingUp = false;
            }
            PlayerMove();
            DrawEnemys();
            moveEnemys();
        }


        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        } // end func 

    </script>
</body>
