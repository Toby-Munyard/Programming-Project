<!doctype html>

<body>
    <canvas id="gameCanvas" width="1000" height="700"></canvas>
    <script>
        var canvas, canvasContext;

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', KeyPressed);
            document.addEventListener('keyup', KeyReleased);

            setInterval(mainloop, 1000 / 50);
        }

        //player vars
        var PlayerXpos = 0;
        var PlayerYpos = 0;
        const PLAYER_SIZE = 60;
        var PlayerXspeed = 10;
        var PlayerYspeed = 10;
        var ship = new Image();
        ship.src = 'images/Ship.png'

        //Background vars
        var backgroundheight = 800;
        var backgroundwidth = 1000;
        var background = new Image();
        var Endgame = new Image();
        background.src = 'images/Background.jpg';
        Endgame.src = 'images/GameOver.jpg'

        //control vars
        var leftKeyPressed = false;
        var rightKeyPressed = false;
        var upKeyPressed = false;
        var downKeyPressed = false;

        const LEFT_KEY = 37;
        const UP_KEY = 38;
        const RIGHT_KEY = 39;
        const DOWN_KEY = 40;
        const SPACE_KEY = 32;

        //enemy vars
        var Enemys = [];
        var settingUp = true;
        var totalEnemys = 10;
        var enemysprite = new Image();
        enemysprite.src = 'images/enemy.png';

        //health
        var pickups = [];
        var settingup = true;
        var totalpickup = 2;
        var pickupSprite = new Image();
        pickupSprite.src = 'images/pickup.png';

        //scoring vars
        var Health = 5;
        var Kills = 0;
        var Timer = 60;

        //bullet vars
        var bulletXpos = 0;
        var bulletYpos = 0;
        const BULLET_WIDTH = 60;
        const BULLET_HEIGHT = 60;
        var bulletYspeed = 10;
        var bullet = new Image();
        bullet.src = 'images/bullet.png';

        //Endgame vars
        var gameRun = true;

        var userName = '';

        while (userName == '' || userName == null) {
            userName = prompt('what is your name?');
        }

        var difficulty = 'easy';
        var pass = false;
        while(pass == false){
            difficulty = prompt('how hard do you want it? easy, medium or hard?', 'easy');
            if(difficulty == 'easy' || difficulty == 'medium' || difficulty == 'hard'){
                pass = true;
            }
        
        }

        //        difficulty = Number(difficulty) // makes a number
        var gameSpeed = 0;
        var max = 4;
        var min = 2;
        if (difficulty == 'easy') {
            min = 5;
            max = 10;
            console.log(max)
        }
        if (difficulty == 'medium') {
            min = 10;
            max = 20;
            console.log(max)
        }
        if (difficulty == 'hard') {
            min = 50;
            max = 100;
            console.log(max)
        } 

        function KeyPressed(evt) {
            if (evt.keyCode == LEFT_KEY) { //left
                leftKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_KEY) { // right
                rightKeyPressed = true;
            }
            if (evt.keyCode == UP_KEY) { // up
                upKeyPressed = true;
            }
            if (evt.keyCode == DOWN_KEY) { // down
                downKeyPressed = true;
            }
            if (evt.keyCode == SPACE_KEY) { // space
                shooting = true;
            }
        } // end func Controls

        function KeyReleased(evt) {
            if (evt.keyCode == LEFT_KEY) { //left
                leftKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_KEY) { // right
                rightKeyPressed = false;
            }
            if (evt.keyCode == UP_KEY) { // up
                upKeyPressed = false;
            }
            if (evt.keyCode == DOWN_KEY) { // down
                downKeyPressed = false;
            }
        } // end func Controls

        var shooting = false;
        var shot = false;

        function bulletShoot() {
            if (shooting && shot == false) {
                bulletXpos = PlayerXpos + PLAYER_SIZE / 2 - BULLET_WIDTH / 2; // x center
                bulletYpos = PlayerYpos;
                shot = true;
            }
            if (shooting && shot) {
                bulletYpos -= bulletYspeed;
            }
            //            if (bulletYpos < 0 || bulletXpos + BULLET_WIDTH > Enemys.EnemyXpos && bulletXpos < Enemys.EnemyXpos + Enemys.EnemySize && bulletYpos + BULLET_HEIGHT > Enemys.EnemyYpos && bulletYpos < Enemys.EnemyYpos + Enemys.EnemySize) {
            //                shot = false;
            //                shooting = false;
            //            }
            if (shot == false && shooting == false) {
                bulletXpos = 0 - BULLET_WIDTH;
                bulletYpos = 0;
            }
        } // end func 

        function PlayerMove() {
            if (rightKeyPressed) {
                PlayerXpos += PlayerXspeed;
                if (PlayerXpos > canvas.width) {
                    PlayerXpos = 0;
                }
            }
            if (leftKeyPressed) {
                PlayerXpos -= PlayerXspeed;
                if (PlayerXpos < 0 - PLAYER_SIZE) {
                    PlayerXpos = canvas.width - PLAYER_SIZE;
                }
            }
            if (upKeyPressed) {
                PlayerYpos -= PlayerYspeed;
                if (PlayerYpos < 0 - PLAYER_SIZE) {
                    PlayerYpos = canvas.height - PLAYER_SIZE;
                }
            }
            if (downKeyPressed) {
                PlayerYpos += PlayerYspeed;
                if (PlayerYpos > canvas.width) {
                    PlayerYpos = 0;
                }
            }
        } // end func

        function setUp() {
            var EnemySize = Math.floor(Math.random() * (100 - 10)) + 10;
            var EnemyXpos = Math.floor(Math.random() * ((canvas.width - EnemySize) - 0)) + 0;
            var EnemyYpos = Math.floor(Math.random() * ((canvas.height - EnemySize) - 0)) + 0;
            var EnemyYspeed = Math.floor(Math.random() * (max - min)) + min;
            var EnemyXspeed = Math.floor(Math.random() * (max - min)) + min;

            var Enemy = {
                EnemyXpos: EnemyXpos,
                EnemyYpos: EnemyYpos,
                EnemySize: EnemySize,
                EnemyXspeed: EnemyXspeed,
                EnemyYspeed: EnemyYspeed,
            }

            Enemys.push(Enemy);

        } // end func

        function createPickUp() {
            var PickupSize = Math.floor(Math.random() * (100 - 10)) + 10;
            var PickupXpos = Math.floor(Math.random() * ((canvas.width - PickupSize) - 0)) + 0;
            var PickupYpos = Math.floor(Math.random() * ((canvas.height - PickupSize) - 0)) + 0;

            var p = {
                PickupXpos: PickupXpos,
                PickupYpos: PickupYpos,
                PickupSize: PickupSize,
            }

            pickups.push(p);

        } //end func

        var counter = 0;
        var randTime = Math.floor(Math.random() * 100);

        function pickUpGen() {
            counter++;

            if (counter == randTime) {
                createPickUp();
                randTime = Math.floor(Math.random() * 100);
                counter = 0;
                console.log('health')
            }
        } // end func

        function DrawPickups() {
            pickups.forEach(function(health, i) {
                drawImg(pickupSprite, health.PickupXpos, health.PickupYpos, health.PickupSize, health.PickupSize);

                if (health.PickupYpos + health.PickupSize > PlayerYpos && health.PickupYpos < PlayerYpos + PLAYER_SIZE && health.PickupXpos + health.PickupSize > PlayerXpos && health.PickupXpos < PlayerXpos + PLAYER_SIZE) {
                    health.PickupXpos = 10000;
                    health.PickupYpos = 10000;
                    Health++;
                }
            });
        }; // end func
        function DrawEnemys() {
            Enemys.forEach(function(Enemy, i) {
                drawImg(enemysprite, Enemy.EnemyXpos, Enemy.EnemyYpos, Enemy.EnemySize, Enemy.EnemySize);
            });
        }; // end func

        function EnemyRandomSpawns() {
            math.random() * canvas.width
        }; // end func

        function moveEnemys() {
            Enemys.forEach(function(Enemy, i) {
                Enemy.EnemyXpos += Enemy.EnemyXspeed; // move x
                Enemy.EnemyYpos += Enemy.EnemyYspeed; // move y

                //Right edge bounce
                if (Enemy.EnemyXpos + Enemy.EnemySize > canvas.width) {
                    Enemy.EnemyXspeed *= -1;

                }

                //Left Edge Bounce
                if (Enemy.EnemyXpos < 0) {
                    Enemy.EnemyXspeed *= -1;
                }

                if (Enemy.EnemyYpos > canvas.height) {
                    Enemy.EnemyYpos = 0 - Enemy.EnemySize;
                    Enemy.EnemySize = Math.floor(Math.random() * (80 - 10)) + 10;
                    Enemy.EnemyYspeed = Math.floor(Math.random() * (10 - 1)) + 1;
                    Enemy.EnemyXspeed = Math.floor(Math.random() * (10 - 1)) + 1;

                }
                if (Enemy.EnemyYpos + Enemy.EnemySize > PlayerYpos && Enemy.EnemyYpos < PlayerYpos + PLAYER_SIZE && Enemy.EnemyXpos + Enemy.EnemySize > PlayerXpos && Enemy.EnemyXpos < PlayerXpos + PLAYER_SIZE) {
                    Enemy.EnemyXpos = 0;
                    Enemy.EnemyYpos = 0;
                    PlayerXpos = canvas.width / 2 - PLAYER_SIZE / 2;
                    PlayerYpos = canvas.height * .8;
                    Health--;
                    console.log('Health:' + Health);
                }
                if (bulletYpos < 0 || bulletXpos + BULLET_WIDTH > Enemy.EnemyXpos && bulletXpos < Enemy.EnemyXpos + Enemy.EnemySize && bulletYpos + BULLET_HEIGHT > Enemy.EnemyYpos && bulletYpos < Enemy.EnemyYpos + Enemy.EnemySize) {
                    Enemy.EnemyYpos = 0;
                    Kills++;
                    console.log('Kills:' + Kills)
                    shot = false;
                    shooting = false;
                }

            });
        } //end func

        function drawImg(src, x, y, w, h) {
            canvasContext.drawImage(src, x, y, w, h);
        } // end func

        function GameOver() {
            if (Health < 1) {
                gameRun = false;
            }
            if (Kills > 10) {
                max + 10;
            }
            if (Kills > 20) {
                max + 20;
            }

        } // end func
        function mainloop() {
            if (gameRun) {
                drawImg(background, 0, 0, backgroundwidth, backgroundheight); //bg
                drawImg(ship, PlayerXpos, PlayerYpos, 60, 90); //player
                drawImg(bullet, bulletXpos, bulletYpos, BULLET_WIDTH, BULLET_HEIGHT, 'red') //bullet
                //            drawImg(enemysprite, 0 ,0,0 ,0);//enemy
                //            drawImg(pickupSprite,100,100,50,50);//healthpickup
                pickUpGen();
                DrawPickups();

                if (settingUp) {
                    for (var i = 0; i < totalEnemys; i++) {
                        setUp();
                    }
                    settingUp = false;
                }
                PlayerMove();
                DrawEnemys();
                moveEnemys();
                bulletShoot();
                GameOver();
                colorText('Arrow Keys to move | Space to attack', 50, 50, '20px Arial', 'Lime')
                colorText(userName + "'s score is " + Kills, 50, 100, '20px Arial', 'Lime')
                colorText(userName + "'s health is " + Health, 50, 150, '20px Arial', 'Lime')
            } else {
                drawImg(Endgame, 0, 0, backgroundwidth, backgroundheight); //endgame
                colorText('Game Over!', 50, 50, '20px Arial', 'Red')
                colorText(userName + ' your score was ' + Kills, 50, 100, '20px Arial', 'Red')
                colorText('Hit the reload page button in the top left to try again!', 50, 150, '20px Arial', 'Red')
            }
        } // end func everything the game needs to run is in here, don't delete it


        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        } // end func canvas background

        function colorText(msg, x, y, f, c) {
            canvasContext.fillStyle = c;
            canvasContext.font = f;
            canvasContext.fillText(msg, x, y);
        } // end func Gameover text

    </script>
</body>
